define("jquery.jtemplates",[],function(require,exports,module){return function(jQuery){return function(jQuery){var Template=function(a,b,c){this._tree=[],this._param={},this._includes=null,this._templates={},this._templates_code={},this.settings=jQuery.extend({disallow_functions:!1,filter_data:!0,filter_params:!1,runnable_functions:!1,clone_data:!0,clone_params:!0},c),this.f_cloneData=void 0!==this.settings.f_cloneData?this.settings.f_cloneData:TemplateUtils.cloneData,this.f_escapeString=void 0!==this.settings.f_escapeString?this.settings.f_escapeString:TemplateUtils.escapeHTML,this.f_parseJSON=void 0!==this.settings.f_parseJSON?this.settings.f_parseJSON:this.settings.disallow_functions?jQuery.parseJSON:TemplateUtils.parseJSON,null!=a&&(this.splitTemplates(a,b),a&&this.setTemplate(this._templates_code.MAIN,b,this.settings),this._templates_code=null)};Template.version="0.8.2",Template.DEBUG_MODE=!1,Template.FOREACH_LOOP_LIMIT=1e4,Template.guid=0,Template.prototype.splitTemplates=function(a,b){for(var d,e,f,c=/\{#template *(\w+) *(.*?) *\}/g,g=null,h=[];null!=(d=c.exec(a));){if(g=c.lastIndex,e=d[1],f=a.indexOf("{#/template "+e+"}",g),-1==f)throw new Error('jTemplates: Template "'+e+'" is not closed.');this._templates_code[e]=a.substring(g,f),h[e]=TemplateUtils.optionToObject(d[2])}if(null===g)return this._templates_code.MAIN=a,void 0;for(var i in this._templates_code)"MAIN"!=i&&(this._templates[i]=new Template);for(var i in this._templates_code)"MAIN"!=i&&(this._templates[i].setTemplate(this._templates_code[i],jQuery.extend({},b||{},this._templates||{}),jQuery.extend({},this.settings,h[i])),this._templates_code[i]=null)},Template.prototype.setTemplate=function(a,b,c){if(void 0==a)return this._tree.push(new TextNode("",1,this)),void 0;a=a.replace(/[\n\r]/g,""),a=a.replace(/\{\*.*?\*\}/g,""),this._includes=jQuery.extend({},this._templates||{},b||{}),this.settings=new Object(c);for(var h,d=this._tree,e=a.match(/\{#.*?\}/g),f=0,g=0,i=0,j=0,k=0,l=e?e.length:0;l>k;++k){var m=e[k];if(i){if(g=a.indexOf("{#/literal}"),-1==g)throw new Error("jTemplates: No end of literal.");g>f&&d.push(new TextNode(a.substring(f,g),1,this)),f=g+11,i=0,k=jQuery.inArray("{#/literal}",e)}else{g=a.indexOf(m,f),g>f&&d.push(new TextNode(a.substring(f,g),i,this)),m.match(/\{#([\w\/]+).*?\}/);var o=RegExp.$1;switch(o){case"elseif":++j,d.switchToElse();case"if":h=new opIF(m,d,this),d.push(h),d=h;break;case"else":d.switchToElse();break;case"/if":for(;j;)d=d.getParent(),--j;case"/for":case"/foreach":d=d.getParent();break;case"foreach":h=new opFOREACH(m,d,this),d.push(h),d=h;break;case"for":h=opFORFactory(m,d,this),d.push(h),d=h;break;case"continue":case"break":d.push(new JTException(o));break;case"include":d.push(new Include(m,this._includes,this));break;case"param":d.push(new UserParam(m,this));break;case"var":d.push(new UserVariable(m,this));break;case"cycle":d.push(new Cycle(m));break;case"ldelim":d.push(new TextNode("{",1,this));break;case"rdelim":d.push(new TextNode("}",1,this));break;case"literal":i=1;break;case"/literal":if(Template.DEBUG_MODE)throw new Error("jTemplates: Missing begin of literal.");break;default:if(Template.DEBUG_MODE)throw new Error("jTemplates: unknown tag: "+o+".")}f=g+m.length}}a.length>f&&d.push(new TextNode(a.substr(f),i,this))},Template.prototype.get=function(a,b,c,d){++d,1==d&&void 0!=c&&jQuery.removeData(c,"jTemplatesRef");var f,e=a;this.settings.clone_data&&(e=this.f_cloneData(a,{escapeData:this.settings.filter_data&&1==d,noFunc:this.settings.disallow_functions},this.f_escapeString)),f=this.settings.clone_params?jQuery.extend({},this.f_cloneData(this._param,{escapeData:this.settings.filter_params,noFunc:!1},this.f_escapeString),this.f_cloneData(b,{escapeData:this.settings.filter_params&&1==d,noFunc:!1},this.f_escapeString)):jQuery.extend({},this._param,b);for(var g="",h=0,i=this._tree.length;i>h;++h)g+=this._tree[h].get(e,f,c,d);return this.EvalObj=null,--d,g},Template.prototype.getBin=function(){return null==this.EvalObj&&(this.EvalObj=new EvalClass(this)),this.EvalObj},Template.prototype.setParam=function(a,b){this._param[a]=b},TemplateUtils=function(){},TemplateUtils.escapeHTML=function(a){return a.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},TemplateUtils.cloneData=function(a,b,c){if(null==a)return"";switch(a.constructor){case Object:var d={};for(var e in a)d[e]=TemplateUtils.cloneData(a[e],b,c);return b.noFunc||a.hasOwnProperty("toString")&&(d.toString=a.toString),d;case Array:for(var d=[],e=0,f=a.length;f>e;++e)d[e]=TemplateUtils.cloneData(a[e],b,c);return d;case String:return b.escapeData?c(a):a;case Function:if(b.noFunc){if(Template.DEBUG_MODE)throw new Error("jTemplates: Functions are not allowed.");return void 0}}return a},TemplateUtils.optionToObject=function(a){if(null===a||void 0===a)return{};var b=a.split(/[= ]/);""===b[0]&&b.shift();for(var c={},d=0,e=b.length;e>d;d+=2)c[b[d]]=b[d+1];return c},TemplateUtils.parseJSON=function(a){if("string"!=typeof a||!a)return null;try{return new Function("return "+jQuery.trim(a))()}catch(b){if(Template.DEBUG_MODE)throw new Error("jTemplates: Invalid JSON");return{}}},TemplateUtils.ReturnRefValue=function(a,b,c){for(;null!=a;){var d=jQuery.data(a,"jTemplatesRef");if(void 0!=d&&d.guid==b&&void 0!=d.d[c])return d.d[c];a=a.parentNode}return null};var TextNode=function(a,b,c){this._value=a,this._literalMode=b,this._template=c};TextNode.prototype.get=function(a,b,c){if(this._literalMode)return this._value;for(var e=this._value,f="",g=-1,h=0,i=-1,j=0;;){var k=e.indexOf("{",g+1),l=e.indexOf("}",g+1);if(0>k&&0>l)break;-1!=k&&l>k||-1==l?(g=k,1==++h&&(i=k,f+=e.substring(j,g),j=-1)):(g=l,0===--h?i>=0&&(f+=this._template.getBin().evaluateContent(a,b,c,e.substring(i,l+1)),i=-1,j=g+1):0>h&&(h=0))}return j>-1&&(f+=e.substr(j)),f},EvalClass=function(a){this.__templ=a},EvalClass.prototype.evaluateContent=function($T,$P,$Q,__value){try{var result=eval(__value);if(jQuery.isFunction(result)){if(this.__templ.settings.disallow_functions||!this.__templ.settings.runnable_functions)return"";result=result($T,$P,$Q)}return void 0===result?"":String(result)}catch(e){if(Template.DEBUG_MODE)throw e instanceof JTException&&(e.type="subtemplate"),e;return""}},EvalClass.prototype.evaluate=function($T,$P,$Q,__value){return eval(__value)};var opIF=function(a,b,c){this._parent=b,a.match(/\{#(?:else)*if (.*?)\}/),this._cond=RegExp.$1,this._onTrue=[],this._onFalse=[],this._currentState=this._onTrue,this._templ=c};opIF.prototype.push=function(a)
	{this._currentState.push(a)},opIF.prototype.getParent=function(){return this._parent},opIF.prototype.switchToElse=function(){this._currentState=this._onFalse},opIF.prototype.get=function(a,b,c,d){var e="";try{for(var f=this._templ.getBin().evaluate(a,b,c,this._cond)?this._onTrue:this._onFalse,g=0,h=f.length;h>g;++g)e+=f[g].get(a,b,c,d)}catch(i){if(Template.DEBUG_MODE||i instanceof JTException)throw i}return e},opFORFactory=function(a,b,c){if(a.match(/\{#for (\w+?) *= *(\S+?) +to +(\S+?) *(?:step=(\S+?))*\}/)){var d=new opFOREACH(null,b,c);return d._name=RegExp.$1,d._option={begin:RegExp.$2||0,end:RegExp.$3||-1,step:RegExp.$4||1,extData:"$T"},d._runFunc=function(a){return a},d}throw new Error('jTemplates: Operator failed "find": '+a)};var opFOREACH=function(a,b,c){this._parent=b,this._template=c,null!=a&&(a.match(/\{#foreach +(.+?) +as +(\w+?)( .+)*\}/),this._arg=RegExp.$1,this._name=RegExp.$2,this._option=RegExp.$3||null,this._option=TemplateUtils.optionToObject(this._option)),this._onTrue=[],this._onFalse=[],this._currentState=this._onTrue};opFOREACH.prototype.push=function(a){this._currentState.push(a)},opFOREACH.prototype.getParent=function(){return this._parent},opFOREACH.prototype.switchToElse=function(){this._currentState=this._onFalse},opFOREACH.prototype.get=function(a,b,c,d){try{var e=void 0===this._runFunc?this._template.getBin().evaluate(a,b,c,this._arg):this._runFunc;if(e===$)throw new Error("jTemplate: Variable '$' cannot be used as loop-function");var f=[],g=typeof e;if("object"==g){var h=[];jQuery.each(e,function(a,b){f.push(a),h.push(b)}),e=h}var i=void 0!==this._option.extData?this._template.getBin().evaluate(a,b,c,this._option.extData):null!=a?a:{};null==i&&(i={});var k,j=Number(this._template.getBin().evaluate(a,b,c,this._option.begin)||0),l=Number(this._template.getBin().evaluate(a,b,c,this._option.step)||1);k="function"!=g?e.length:void 0===this._option.end||null===this._option.end?Number.MAX_VALUE:Number(this._template.getBin().evaluate(a,b,c,this._option.end))+(l>0?1:-1);var n,o,m="";if(this._option.count){var p=j+Number(this._template.getBin().evaluate(a,b,c,this._option.count));k=p>k?k:p}if(k>j&&l>0||j>k&&0>l)for(var s,t,q=0,r="function"!=g?Math.ceil((k-j)/l):void 0,u=0;l>0?k>j:j>k;j+=l,++q,++u){if(Template.DEBUG_MODE&&u>Template.FOREACH_LOOP_LIMIT)throw new Error("jTemplate: Foreach loop limit was exceed");if(s=f[j],"function"!=g)t=e[j];else if(t=e(j),void 0===t||null===t)break;if(("function"!=typeof t||!this._template.settings.disallow_functions&&this._template.settings.runnable_functions)&&!("object"==g&&s in Object&&t===Object[s])){var v=i[this._name];for(i[this._name]=t,i[this._name+"$index"]=j,i[this._name+"$iteration"]=q,i[this._name+"$first"]=0==q,i[this._name+"$last"]=j+l>=k,i[this._name+"$total"]=r,i[this._name+"$key"]=void 0!==s&&s.constructor==String?this._template.f_escapeString(s):s,i[this._name+"$typeof"]=typeof t,n=0,o=this._onTrue.length;o>n;++n)try{m+=this._onTrue[n].get(i,b,c,d)}catch(w){if(!(w instanceof JTException))throw w;switch(w.type){case"continue":n=o;break;case"break":n=o,j=k;break;default:throw w}}delete i[this._name+"$index"],delete i[this._name+"$iteration"],delete i[this._name+"$first"],delete i[this._name+"$last"],delete i[this._name+"$total"],delete i[this._name+"$key"],delete i[this._name+"$typeof"],delete i[this._name],i[this._name]=v}}else for(n=0,o=this._onFalse.length;o>n;++n)m+=this._onFalse[n].get(a,b,c,d);return m}catch(k){if(Template.DEBUG_MODE||k instanceof JTException)throw k;return""}};var JTException=function(a){this.type=a};JTException.prototype=Error,JTException.prototype.get=function(){throw this};var Include=function(a,b,c){if(a.match(/\{#include (.*?)(?: root=(.*?))?\}/),this._template=b[RegExp.$1],void 0==this._template&&Template.DEBUG_MODE)throw new Error("jTemplates: Cannot find include: "+RegExp.$1);this._root=RegExp.$2,this._mainTempl=c};Include.prototype.get=function(a,b,c,d){try{return this._template.get(this._mainTempl.getBin().evaluate(a,b,c,this._root),b,c,d)}catch(e){if(Template.DEBUG_MODE||e instanceof JTException)throw e}return""};var UserParam=function(a,b){a.match(/\{#param name=(\w*?) value=(.*?)\}/),this._name=RegExp.$1,this._value=RegExp.$2,this._templ=b};UserParam.prototype.get=function(a,b,c){try{b[this._name]=this._templ.getBin().evaluate(a,b,c,this._value)}catch(e){if(Template.DEBUG_MODE||e instanceof JTException)throw e;b[this._name]=void 0}return""};var UserVariable=function(a,b){a.match(/\{#var (.*?)\}/),this._id=RegExp.$1,this._templ=b};UserVariable.prototype.get=function(a,b,c){try{if(void 0==c)return"";var e=this._templ.getBin().evaluate(a,b,c,this._id),f=jQuery.data(c,"jTemplatesRef");void 0==f&&(f={guid:++Template.guid,d:[]});var g=f.d.push(e);return jQuery.data(c,"jTemplatesRef",f),"(TemplateUtils.ReturnRefValue(this,"+f.guid+","+(g-1)+"))"}catch(h){if(Template.DEBUG_MODE||h instanceof JTException)throw h;return""}};var Cycle=function(oper){if(oper.match(/\{#cycle values=(.*?)\}/),this._values=eval(RegExp.$1),this._length=this._values.length,0>=this._length)throw new Error("jTemplates: no elements for cycle");this._index=0,this._lastSessionID=-1};Cycle.prototype.get=function(a,b,c){var e=jQuery.data(c,"jTemplateSID");e!=this._lastSessionID&&(this._lastSessionID=e,this._index=0);var f=this._index++%this._length;return this._values[f]},jQuery.fn.setTemplate=function(a,b,c){return a.constructor===Template?jQuery(this).each(function(){jQuery.data(this,"jTemplate",a),jQuery.data(this,"jTemplateSID",0)}):jQuery(this).each(function(){jQuery.data(this,"jTemplate",new Template(a,b,c)),jQuery.data(this,"jTemplateSID",0)})},jQuery.fn.setTemplateURL=function(a,b,c){var d=jQuery.ajax({url:a,dataType:"text",async:!1,type:"GET"}).responseText;return jQuery(this).setTemplate(d,b,c)},jQuery.fn.setTemplateElement=function(a,b,c){var d=jQuery("#"+a).val();return null==d&&(d=jQuery("#"+a).html(),d=d.replace(/&lt;/g,"<").replace(/&gt;/g,">")),d=jQuery.trim(d),d=d.replace(/^<\!\[CDATA\[([\s\S]*)\]\]>$/im,"$1"),d=d.replace(/^<\!--([\s\S]*)-->$/im,"$1"),jQuery(this).setTemplate(d,b,c)},jQuery.fn.hasTemplate=function(){var a=0;return jQuery(this).each(function(){jQuery.getTemplate(this)&&++a}),a},jQuery.fn.removeTemplate=function(){return jQuery(this).processTemplateStop(),jQuery(this).each(function(){jQuery.removeData(this,"jTemplate")})},jQuery.fn.setParam=function(a,b){return jQuery(this).each(function(){var c=jQuery.getTemplate(this);if(void 0!==c)c.setParam(a,b);else if(Template.DEBUG_MODE)throw new Error("jTemplates: Template is not defined.")})},
	jQuery.fn.processTemplate=function(a,b,c){return jQuery(this).each(function(){var d=jQuery.getTemplate(this);if(void 0!==d)void 0!=c&&c.StrToJSON&&(a=d.f_parseJSON(a)),jQuery.data(this,"jTemplateSID",jQuery.data(this,"jTemplateSID")+1),jQuery(this).html(d.get(a,b,this,0));else if(Template.DEBUG_MODE)throw new Error("jTemplates: Template is not defined.")})},jQuery.fn.processTemplateURL=function(a,b,c){var d=this,e=jQuery.extend({cache:!1},jQuery.ajaxSettings);return e=jQuery.extend(e,c),jQuery.ajax({url:a,type:e.type,data:e.data,dataFilter:e.dataFilter,async:e.async,cache:e.cache,timeout:e.timeout,dataType:"text",success:function(a){var c=jQuery(d).processTemplate(a,b,{StrToJSON:!0});e.on_success&&e.on_success(c)},error:e.on_error,complete:e.on_complete}),this};var Updater=function(a,b,c,d,e,f){this._url=a,this._param=b,this._interval=c,this._args=d,this.objs=e,this.timer=null,this._options=f||{};var g=this;jQuery(e).each(function(){jQuery.data(this,"jTemplateUpdater",g)}),this.run()};Updater.prototype.run=function(){if(this.detectDeletedNodes(),0!=this.objs.length){var a=this;jQuery.ajax({url:this._url,dataType:"text",data:this._args,cache:!1,success:function(b){try{var c=jQuery(a.objs).processTemplate(b,a._param,{StrToJSON:!0});a._options.on_success&&a._options.on_success(c)}catch(d){}}}),this.timer=setTimeout(function(){a.run()},this._interval)}},Updater.prototype.detectDeletedNodes=function(){this.objs=jQuery.grep(this.objs,function(a){if(jQuery.browser.msie){for(var b=a.parentNode;b&&b!=document;)b=b.parentNode;return null!=b}return null!=a.parentNode})},jQuery.fn.processTemplateStart=function(a,b,c,d,e){return new Updater(a,b,c,d,this,e)},jQuery.fn.processTemplateStop=function(){return jQuery(this).each(function(){var a=jQuery.data(this,"jTemplateUpdater");if(null!=a){var b=this;a.objs=jQuery.grep(a.objs,function(a){return a!=b}),jQuery.removeData(this,"jTemplateUpdater")}})},jQuery.extend({createTemplate:function(a,b,c){return new Template(a,b,c)},createTemplateURL:function(a,b,c){var d=jQuery.ajax({url:a,dataType:"text",async:!1,type:"GET"}).responseText;return new Template(d,b,c)},getTemplate:function(a){return jQuery.data(a,"jTemplate")},processTemplateToText:function(a,b,c){return a.get(b,c,void 0,0)},jTemplatesDebugMode:function(a){Template.DEBUG_MODE=a}})}(jQuery),jQuery.noConflict(!0)}});